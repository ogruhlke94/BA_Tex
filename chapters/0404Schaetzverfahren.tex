\subsection{Schätzverfahren}
\label{sec_curveFit}
In diesem Abschnitt wird das implementierte Schätzverfahren erläutert. Das Verfahren nutzt die Ergebnisse der Bilderkennung und versucht mithilfe der Regression ein Polynom $f$ zweiten Grades durch alle erkannten Punkte in Betrachtung ihrer Orientierung zu fitten.
Das Verfahren basiert auf dem \textit{Least-Squares} Verfahren\cite{simon2006optimal}, wobei versucht wird die Gleichung \ref{lsq} zu minimieren.\\
$x_i$ und $y_i$ sind hierbei die Koordinaten der erkannten Punkte. Es wird über alle Punkte summiert der quadratische Fehler vom Funktionswert zu gegebenen Parametern zum $y$ aus der Bilderkennung berechnet. $f(p,x)$ ist eine beliebige Funktion, die $x$ in Abhängigkeit von $p$ auf eine reelle Zahl abbildet.\\
\begin{ownequation}[H]
\begin{equation}
err = \sum_{i}(f(p,x_i)-y_i)^2
\end{equation}
\caption{Least Squares Ansatz}
\label{lsq}
\end{ownequation}
Über die Zeit gesehen wird die Menge an detektierten Punkten immer größer. Da das Ziel des Verfahrens die Vorhersage des Objektverlaufs ist, ist eine gute Extrapolation wichtiger als das richtige Abbilden aller Punkte der Vergangenheit. Für die Extrapolation ist anzunehmen, dass neuere Punkte für den Verlauf wichtiger sind als ältere. Aus diesem Grund werden die Punkte über die Zeit exponentiell abnehmend gewichtet. Somit erhalten aktuelle Punkte einen höheren Stellenwert als ältere, ohne jedoch alte Punkte komplett zu verwerfen.\\
Um diese Anforderungen umzusetzen habe ich eine Erweiterung des \textit{Least-Squares} genutzt, den \textit{Weighted-Least-Squares}[Gleichung \ref{wlsq}]\\
\begin{ownequation}[H]
\begin{equation}
err = \sum_{i}w_i \cdot (f(p,x_i)-y_i)^2
\end{equation}
\caption{Weighted Least Squares Verfahren}
\label{wlsq}
\end{ownequation}

Das \textit{Weighted-Least-Squares} Verfahren bietet eine gute Grundlage für die Regression. Es bleiben jedoch noch einige Probleme, die das Verfahren in der Form nicht lösen kann.
\begin{enumerate}
\item Beachtung der Orientierung erkannter Punkte
\item Bedingungen für die Kurve (z.B. maximale Steigung)
\item Schätzungen, für Punktverläufe, die sich nicht durch ein einzelnes Polynom darstellen lassen
\end{enumerate}

Zum Lösen der ersten zwei Probleme bietet die \matlab Funktion \textit{fmincon}\footnote{https://de.mathworks.com/help/optim/ug/fmincon.html} aus der Optimization Toolbox eine geeignete Lösung. Die Funktion bietet die die Möglichkeit eine Funktion $F(p)$ zu minimieren, wobei mit $c(p) \leq 0$ eine Bedingung erfüllt werden muss. Die Funktion $c(p,x_i)$ [Gleichung \ref{constraint}] berechnet über den Funktionsverlauf von $f(p,x)$ mithilfe der Ableitung $f'(p,x)$ die Steigung in jedem Punkt $x_i$. Da \textit{fmincon} prüft, ob die Bedingungsfunktion kleiner 0 ist wird von der Steigung ein Maximalwert ($max_{slope}$) abgezogen (\textit{Erfüllt 2.}).\\
\begin{ownequation}[H]
\begin{equation}
c(p,x_i) = f'(p,x_i)-max_{slope}
\end{equation}
\caption{Funktion zum überprüfen, ob die Steigung einen Maximalwert nicht übersteigt.}
\label{constraint}
\end{ownequation}
Die Funktion $F(p)$ wird als $F(p,x,y,s,w,n,m,tau)$ [Gleichung \ref{minimizeFunction}] definiert, wobei $x$ und $y$ wieder die Punkte der Bilderkennung darstellen, $s$ die erkannte Orientierung im Punkt und $w$ das Gewicht. Die Funktion $F$ besteht aus einer Linearkombination der Funktionen $g$ und $h$, wobei $g$ den summierten Fehler der Position [Gleichung \ref{posError}] ($x$,$y$ Koordinaten) und $h$ den summierten Fehler der Orientierung [Gleichung \ref{orienError}] mithilfe des \textit{Weighted-Least-Squares} Verfahren berechnen (\textit{Erfüllt 1.}). $n$ und $m$ gewichten, wie stark die einzelnen Fehlerarten (Position und Orientierung) in den Gesamtfehler für die gegebenen Funktionsparameter $p$ eingehen.\\
Um die erhaltenen Polynome einschränken zu können, wurde $F$ noch gemäß der \textit{Tikhonov Regularisierung} \cite{kaipio2006statistical} angepasst. Durch die \textit{Tikhonov Regularisierung} können wenig gekrümmte Kurven bevorzugt werden, was für einen ruhigeren Fahrtverlauf sorgen kann.
\begin{ownequation}[H]
\begin{equation}
\label{minimizeFunction}
F(p) = F(p,x,y,s,w,n,m,tau) = n \cdot g(p,x,y,w) + m \cdot h(p,x,s,w) + tau \cdot p
\end{equation}
\begin{equation}
\label{posError}
g(p,x,y,w) = \sum_{i} w_i \cdot (f(p,x_i)-y_i)^2
\end{equation}
\begin{equation}
\label{orienError}
h(p,x,s,w) = \sum_{i} w_i \cdot (f'(p,x_i)-s_i)^2
\end{equation}
\caption{Zusammensetzung der Funktion F, die minimiert wird.}
\label{F-function}
\end{ownequation}

Um das Problem 3. zu lösen, betrachten wir Abbildung \ref{prob3}. Das Objekt ist hierbei so gelegen, dass kein Polynom zweiten Grades sinnvoll durch die Daten gelegt werden kann und außerdem ein Teilabschnitt parallel zur $Y-Achse$ verläuft. Der letzte Fall ist zu beachten, da ein solcher Verlauf durch eine unendliche Steigung im Polynom abgebildet werden müsste.\\
Als Lösung für dieses Problem führe ich ein alternatives Weltkoordinatensystem. Dieses unterscheidet sich durch eine Transformation vom echten Weltkoordinatensystem.\\
Nach jeder Regression wird das berechnete Polynom in den aktuellsten Punkten getestet. Sollte dabei ein gewisser Fehlerschwellwert überschritten wird eine neue Transformation berechnet [Listing \ref{transPseudo}]. Diese neue Transformation besteht aus einer Translation zum Punkt mit dem größten $x$-Wert und einer Rotation um die durchschnittliche Ausrichtung der neuesten Punkte. Neben der Transformationsmatrix wird auch die Inverse der Matrix gespeichert, die für die Wegpunktberechnung [Kapitel \ref{sec_waypoint}] wichtig ist. Da die Transformation ausgelöst wird, sobald das Polynom in den neuesten Punkten einen zu großen Fehler ergibt werden nach dem Speichern der Matrizen alle Punkte, bis auf die neuesten verworfen, um ein potentiell besseres Polynom für die Extrapolation zu ermöglichen.\\
Sobald eine beschriebe Transformation gespeichert wurde, werden alle Punkte vor der Regression in das alternative Koordinatensystem transformiert. Durch diese Transformation sind die erkannten Punkte entlang der $X-Achse$ gelegen und somit ist es möglich, stets ein geeignetes Polynom für die Punkte zu finden. Durch die Translation liegen die Punkte stets nah am Ursprung, was den Parameterraum für die Regression verringert und somit zu schnelleren Ergebnissen führt.\label{alterWorldCoords}
\todo{hier noch graphen zur transformation}
\begin{lstlisting}[language=Matlab,caption=Pseudocode des Schätzverfahrens,label=transPseudo]
function polynomFit(points,maxError)
	actualTransform = loadActualTransformation();
	points_T = transformPoints(points,actualTransform);
	
	polynom = regression(points_T);
	error = calculateError(points_T,polynom);
	if (error >= maxError)
		translation = findGreatestXValue(points_T);
		rotation = averageDirectionOfLastPoints(points_T);
		newTransform = createTransMatrix(-translation,-rotation) * actualTransform;
		saveNewTransform();
	end
end
\end{lstlisting}



