\subsection{Transformation}
\label{sec_transformations}
Wie bereits in der Einleitung beschrieben, werden mehrere Koordinatensysteme genutzt. Zur sicheren Verwendung der Koordinatensysteme sind \glspl{transform} unter den Systemen zwingend nötig.
Eine \gls{transform} besteht aus einer Rotation und einer Translation, die sich aus den Beziehungen der Systeme zueinander ergibt.\\
Im \texttt{enum} \textit{frames} [Listing \ref{framesEnum}] sind die verschiedenen Frames definiert, zwischen denen eine \gls{transform} möglich ist.

\lstinputlisting[language=Matlab,caption={Enumeration der Frames,die die verschiedenen Koordinatensystem bezeichnen},label=framesEnum]{frames.m}

Umgesetzt wird eine \gls{transform} aus einem \textit{source} Frame in einen \textit{target} Frame durch die Funktion \texttt{transform} [Listing \ref{transform}]. Die Transformation ist nur in eine Richtung möglich, da die inverse Transformation für diese Arbeit nicht benötigt wurde.

\lstinputlisting[language=Matlab,caption={\gls{transform} von \textit{source} in \textit{target} Frame. Die verschiedenen Transformation werden hier verwaltet und solange die nächste Transformation ausgeführt, bis der \textit{target} Frame erreicht wird.},label=transform]{transform.m}

\subsubsection{Bild zu Kamera}
\label{section_PicToCam}
Die verlustfreie \gls{transform} von 2D-Pixelkoordinaten in 3D-Kamerakoordinaten ist mit einer Kamera nicht möglich, da die Tiefeninformation nicht vorhanden ist. Jedoch lässt sich mit dem Wissen über die Entfernung zur Bildebene, der \textit{flat world assumption} (siehe Kapitel \ref{sec_coordsystems}) und den intrinsischen Kameraparametern eine ausreichend gute Transformation durchführen. Da die Kamera gerade nach unten gerichtet ist, entspricht die Entfernung zur Bildebene der Höhe des \gls{auv}s über dem Meeresboden, welche über die Sensorik bestimmt wird. Die intrinsischen Kameraparameter lassen sich über eine Kamerakalibrierung bestimmen, welche mithilfe der \matlab \textit{Computer Vision System Toolbox} durchgeführt.\\
Da die resultierende \gls{transform} am besten im Abstand der Kalibrierung funktioniert wurde die Kalibrierung in einem Abstand von 6 Metern durchgeführt, was im späteren Verlauf auch der gewünschte Abstand zum Boden ist.\\
Aus der Kamerakalibrierung wird ein \textit{CameraParameter}\footnote{https://de.mathworks.com/help/vision/ref/cameraparameters-class.html} Objekt erzeugt, welches die Methode \textit{pointsToWorld} bietet. Die Methode berechnet eine Projektionsmatrix aus den Kamera-Parametern und dem bekannten Abstand der Kamera zum Objekt. Mithilfe der Inversen dieser Matrix können dann Pixel in Kamerakoordinaten umgerechnet werden.\\
Leichte Neigungswinkel, die während der Fahrt auftreten, können durch die Multiplikation mit der entsprechenden Rotationsmatrix herausgerechnet werden. Jedoch ist dabei zu beachten, dass durch die Neigungswinkel die Fläche, die die Kamera sieht, vergrößert wird. Dadurch bilden einzelne Pixel mehr Fläche ab und die \gls{transform} wird ungenauer.\\
Die $z$-Koordinate ergibt sich aus dem Wissen, Objekte am Meeresboden zu betrachten und der Tatsache, dass die Höhe der Kamera über dem Meeresboden bekannt ist.

\subsubsection{Kamera zu Body}
Die \gls{transform} vom Kamerakoordinatensystem zum Bodykoordinatensystem besteht aus einer Translation und einer Rotation, die durch die Montageposition der Kamera am \gls{auv} bestimmt wird [Kapitel \ref{sec_img_cam_coords}].\\
Aufgrund der Verschiebung der Kamera zum Bodykoordinatenursprung (Schwerpunkt des \gls{auv}s) ergibt sich eine Translation um $1,3$m in x-Richtung und $0,25$m in z-Richtung.\\
Die Rotation beträgt dabei $90^\circ$ um die Z-Achse.\\
Somit ergibt sich die Tranformationsmatrix aus Gleichung \ref{trans_cam_body}\\

\begin{ownequation}[H]
\begin{equation}
\begin{pmatrix}
x_{body}\\y_{body}\\z_{body}\\1
\end{pmatrix}
=
\begin{pmatrix}
0 & -1 & 0& 1,3\\
1 & 0 & 0& 0\\
0 & 0 & 1& 0,25\\
0 & 0 & 0 & 1
\end{pmatrix}
\cdot
\begin{pmatrix}
x_{cam}\\y_{cam}\\z_{cam}\\1
\end{pmatrix}
\end{equation}
\caption[\gls{transform} der Kamerakoordinaten zu Bodykoordinaten]{Transformation der Kamerakoordinaten zu Bodykoordinaten. Die Kamerakoordinaten werden um $1,3$m auf der x-Achse und $0,25$m auf der z-Achse verschoben. Außerdem wird eine Rotation um $90^\circ$ um die Z-Achse durchgeführt.}
\label{trans_cam_body}
\end{ownequation}

\subsubsection{Body zu Welt}
Für die \gls{transform} vom Bodykoordinatensystem in das Weltkoordinatensystem ist wieder eine Translation und eine Rotation nötig.
Aus der Definition der Koordinatensysteme folgt zunächst eine Rotation um $180^\circ$ um die X-Achse nötig.
Die Translation ergibt sich aus der Position des \gls{auv}s (Position Nord/Ost in Metern).\\
Die Rotation wird durch die Ausrichtung des \gls{auv}s in der Welt (\gls{yaw} [Abb. \ref{Abb. 2}]) bestimmt. Somit ergibt sich die Tranformationsmatrix aus Gleichung \ref{trans_body_world}\\

\begin{ownequation}[H]
\begin{equation}
\begin{split}
\begin{pmatrix}
x_{world} \\ y_{world} \\ z_{world} \\ 1
\end{pmatrix}
& =
\begin{pmatrix}
cos(yaw) & -sin(yaw) & 0 & Pos_{north}\\
sin(yaw) & cos(yaw) & 0 & Pos_{east}\\
0 & 0 & 1 & 0\\
0 & 0 & 0 & 1
\end{pmatrix}\\
&\cdot
\left(
\begin{pmatrix}
1 & 0 & 0& 0\\
0 & -1 & 0& 0\\
0 & 0 & -1& 0\\
0 & 0 & 0 & 1
\end{pmatrix}
\cdot
\begin{pmatrix}
x_{body} \\ y_{body} \\ z_{body} \\ 1
\end{pmatrix}
\right)\\
\end{split}
\end{equation}
\caption[\gls{transform} der Bodykoordinaten zu Weltkoordinaten]{Transformation der Bodykoordinaten zu Weltkoordinaten. Zunächst werden die Body-Koordinaten um $180^\circ$ um die X-Achse rotiert. Im Anschluss findet eine Translation zu der Position des \gls{auv}s in der Welt und eine Rotation um die Z-Achse, die die Ausrichtung des \gls{auv}s abbildet, statt.}
\label{trans_body_world}
\end{ownequation}

\subsubsection{Welt zu \vrml}
Für die \gls{transform} von Weltkoordinaten in \vrml Koordinaten ist nur eine Rotation um $-90^\circ$ um die X-Achse nötig [Abb. \ref{trans_world_vrml}].
\begin{ownequation}[H]
\begin{equation}
\begin{pmatrix}
x_{vrml}\\y_{vrml}\\z_{vrml}\\1
\end{pmatrix}
=
\begin{pmatrix}
1 & 0 & 0& 0\\
0 & -1 & 0& 0\\
0 & 0 & -1& 0\\
0 & 0 & 0 & 1
\end{pmatrix}
\cdot
\begin{pmatrix}
x_{body}\\y_{body}\\z_{body}\\1
\end{pmatrix}
\end{equation}
\caption[\gls{transform} von Weltkoordinaten in \vrml Koordinaten]{Transformation von Weltkoordinaten in \vrml Koordinaten. Hierfür ist nur eine Rotation um $-90^\circ$ um die X-Achse nötig.}
\label{trans_world_vrml}
\end{ownequation}